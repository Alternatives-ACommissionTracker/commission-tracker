<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commission Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect } = React;
const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line } = Recharts;

const Icon = ({ d, ...props }) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    {d.map((path, i) => typeof path === 'string' ? <path key={i} d={path} /> : React.cloneElement(path, { key: i }))}
  </svg>
);

const DollarSign = (p) => <Icon {...p} d={[<line x1="12" y1="1" x2="12" y2="23"/>, "M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"]} />;
const Users = (p) => <Icon {...p} d={["M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2", <circle cx="9" cy="7" r="4"/>, "M23 21v-2a4 4 0 0 0-3-3.87", "M16 3.13a4 4 0 0 1 0 7.75"]} />;
const TrendingUp = (p) => <Icon {...p} d={[<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>, <polyline points="17 6 23 6 23 12"/>]} />;
const History = (p) => <Icon {...p} d={["M3 3v5h5", "M3.05 13A9 9 0 1 0 6 5.3L3 8", "M12 7v5l4 2"]} />;
const Plus = (p) => <Icon {...p} d={[<line x1="12" y1="5" x2="12" y2="19"/>, <line x1="5" y1="12" x2="19" y2="12"/>]} />;
const Trash2 = (p) => <Icon {...p} d={[<polyline points="3 6 5 6 21 6"/>, "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2", <line x1="10" y1="11" x2="10" y2="17"/>, <line x1="14" y1="11" x2="14" y2="17"/>]} />;
const Edit2 = (p) => <Icon {...p} d={["M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"]} />;
const Check = (p) => <Icon {...p} d={[<polyline points="20 6 9 17 4 12"/>]} />;
const X = (p) => <Icon {...p} d={[<line x1="18" y1="6" x2="6" y2="18"/>, <line x1="6" y1="6" x2="18" y2="18"/>]} />;
const Eye = (p) => <Icon {...p} d={["M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z", <circle cx="12" cy="12" r="3"/>]} />;
const EyeOff = (p) => <Icon {...p} d={["M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24", <line x1="1" y1="1" x2="23" y2="23"/>]} />;
const Download = (p) => <Icon {...p} d={["M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4", <polyline points="7 10 12 15 17 10"/>, <line x1="12" y1="15" x2="12" y2="3"/>]} />;

function CommissionTracker() {
  const [currentUser, setCurrentUser] = useState(null);
  const [salespeople, setSalespeople] = useState([]);
  const [transactions, setTransactions] = useState([]);
  const [payments, setPayments] = useState([]);
  const [activeTab, setActiveTab] = useState('dashboard');
  const [loginCode, setLoginCode] = useState('');
  const [adminPassword, setAdminPassword] = useState('');
  const [isAdminLogin, setIsAdminLogin] = useState(false);
  const [newSalesperson, setNewSalesperson] = useState({ name: '', code: '', commission: '', email: '' });
  const [newTransaction, setNewTransaction] = useState({ code: '', productName: '', quantity: '1', unitPrice: '', amount: '', date: new Date().toISOString().split('T')[0] });
  const [editingSalesperson, setEditingSalesperson] = useState(null);
  const [showPassword, setShowPassword] = useState(false);
  const [dateFilter, setDateFilter] = useState('all');
  const [customMonth, setCustomMonth] = useState(new Date().toISOString().substring(0, 7));
  const [customYear, setCustomYear] = useState(new Date().getFullYear().toString());

  useEffect(() => {
    const sp = localStorage.getItem('commissionSalespeople');
    const tr = localStorage.getItem('commissionTransactions');
    const py = localStorage.getItem('commissionPayments');
    const pw = localStorage.getItem('commissionAdminPassword');
    if (sp) setSalespeople(JSON.parse(sp));
    if (tr) setTransactions(JSON.parse(tr));
    if (py) setPayments(JSON.parse(py));
    if (!pw) localStorage.setItem('commissionAdminPassword', 'admin123');
  }, []);

  useEffect(() => { localStorage.setItem('commissionSalespeople', JSON.stringify(salespeople)); }, [salespeople]);
  useEffect(() => { localStorage.setItem('commissionTransactions', JSON.stringify(transactions)); }, [transactions]);
  useEffect(() => { localStorage.setItem('commissionPayments', JSON.stringify(payments)); }, [payments]);

  const handleLogin = () => {
    if (isAdminLogin) {
      if (adminPassword === localStorage.getItem('commissionAdminPassword')) {
        setCurrentUser({ type: 'admin', name: 'Administrator' });
        setAdminPassword('');
      } else alert('Invalid admin password');
    } else {
      const sp = salespeople.find(s => s.code.toLowerCase() === loginCode.toLowerCase());
      if (sp) { setCurrentUser({ type: 'salesperson', ...sp }); setLoginCode(''); }
      else alert('Invalid salesperson code');
    }
  };

  const handleLogout = () => { setCurrentUser(null); setActiveTab('dashboard'); };
  const generateCode = () => setNewSalesperson({ ...newSalesperson, code: 'SP' + Math.random().toString(36).substring(2, 8).toUpperCase() });

  const addSalesperson = () => {
    if (!newSalesperson.name || !newSalesperson.code || !newSalesperson.commission) return alert('Please fill in name, code, and commission');
    const com = parseFloat(newSalesperson.commission);
    if (com <= 0 || com > 100) return alert('Commission must be between 0 and 100%');
    if (salespeople.find(s => s.code.toLowerCase() === newSalesperson.code.toLowerCase())) return alert('This code already exists');
    setSalespeople([...salespeople, { id: Date.now(), name: newSalesperson.name, code: newSalesperson.code.toUpperCase(), commission: com, email: newSalesperson.email, createdDate: new Date().toISOString() }]);
    setNewSalesperson({ name: '', code: '', commission: '', email: '' });
  };

  const deleteSalesperson = (id) => {
    if (window.confirm('Delete this salesperson and all their transactions?')) {
      const sp = salespeople.find(s => s.id === id);
      setSalespeople(salespeople.filter(s => s.id !== id));
      setTransactions(transactions.filter(t => t.code !== sp.code));
    }
  };

  const saveEditSalesperson = () => {
    const com = parseFloat(editingSalesperson.commission);
    if (com <= 0 || com > 100) return alert('Commission must be between 0 and 100%');
    setSalespeople(salespeople.map(s => s.id === editingSalesperson.id ? editingSalesperson : s));
    setEditingSalesperson(null);
  };

  const handleQuantityOrPriceChange = (field, value) => {
    const upd = { ...newTransaction, [field]: value };
    if (upd.quantity && upd.unitPrice) {
      const qty = parseFloat(upd.quantity), price = parseFloat(upd.unitPrice);
      if (!isNaN(qty) && !isNaN(price)) upd.amount = (qty * price).toFixed(2);
    }
    setNewTransaction(upd);
  };

  const addTransaction = () => {
    if (!newTransaction.code || !newTransaction.productName || !newTransaction.amount) return alert('Please fill in code, product name, and amount');
    const amt = parseFloat(newTransaction.amount), qty = parseInt(newTransaction.quantity);
    if (amt <= 0 || qty <= 0) return alert('Amount and quantity must be greater than 0');
    const sp = salespeople.find(s => s.code.toLowerCase() === newTransaction.code.toLowerCase());
    if (!sp) return alert('Invalid salesperson code');
    const com = (amt * sp.commission) / 100;
    setTransactions([{ id: Date.now(), code: sp.code, salespersonName: sp.name, productName: newTransaction.productName, quantity: qty, amount: amt, commission: com, commissionRate: sp.commission, date: newTransaction.date, paymentStatus: 'pending' }, ...transactions]);
    setNewTransaction({ code: '', productName: '', quantity: '1', unitPrice: '', amount: '', date: new Date().toISOString().split('T')[0] });
  };

  const deleteTransaction = (id) => { if (window.confirm('Delete this transaction?')) setTransactions(transactions.filter(t => t.id !== id)); };

  const markAsPaid = (tid) => {
    const t = transactions.find(tx => tx.id === tid);
    if (t.paymentStatus === 'pending') {
      setTransactions(transactions.map(tx => tx.id === tid ? { ...tx, paymentStatus: 'paid', paidDate: new Date().toISOString() } : tx));
      setPayments([...payments, { id: Date.now(), transactionId: tid, code: t.code, salespersonName: t.salespersonName, amount: t.commission, date: new Date().toISOString() }]);
    }
  };

  const markAsPending = (tid) => {
    const t = transactions.find(tx => tx.id === tid);
    if (t.paymentStatus === 'paid') {
      setTransactions(transactions.map(tx => tx.id === tid ? { ...tx, paymentStatus: 'pending', paidDate: null } : tx));
      setPayments(payments.filter(p => p.transactionId !== tid));
    }
  };

  const getSalespersonStats = (code) => {
    const st = transactions.filter(t => t.code === code);
    return {
      totalSales: st.reduce((s, t) => s + t.amount, 0),
      totalCommission: st.reduce((s, t) => s + t.commission, 0),
      pendingCommission: st.filter(t => t.paymentStatus === 'pending').reduce((s, t) => s + t.commission, 0),
      paidCommission: st.filter(t => t.paymentStatus === 'paid').reduce((s, t) => s + t.commission, 0),
      count: st.length
    };
  };

  const getTopPerformers = () => salespeople.map(s => ({ ...s, ...getSalespersonStats(s.code) })).sort((a, b) => b.totalCommission - a.totalCommission);

  const getMonthlyData = () => {
    const m = {};
    transactions.forEach(t => {
      const mo = t.date.substring(0, 7);
      if (!m[mo]) m[mo] = { sales: 0, commissions: 0 };
      m[mo].sales += t.amount;
      m[mo].commissions += t.commission;
    });
    return Object.entries(m).sort(([a], [b]) => a.localeCompare(b)).map(([month, data]) => ({ month, ...data }));
  };

  const getFilteredTransactions = () => {
    if (dateFilter === 'all') return transactions;
    if (dateFilter === 'month') return transactions.filter(t => t.date.substring(0, 7) === customMonth);
    if (dateFilter === 'year') return transactions.filter(t => t.date.substring(0, 4) === customYear);
    return transactions;
  };

  const getFilteredStats = () => {
    const f = getFilteredTransactions();
    return {
      totalSales: f.reduce((s, t) => s + t.amount, 0),
      totalCommissions: f.reduce((s, t) => s + t.commission, 0),
      pendingPayments: f.filter(t => t.paymentStatus === 'pending').reduce((s, t) => s + t.commission, 0),
      transactionCount: f.length
    };
  };

  const exportToCSV = () => {
    const h = ['Date', 'Salesperson', 'Code', 'Product', 'Qty', 'Sale', 'Com%', 'Com$', 'Status'];
    const r = transactions.map(t => [t.date, t.salespersonName, t.code, t.productName, t.quantity, t.amount.toFixed(2), t.commissionRate + '%', t.commission.toFixed(2), t.paymentStatus]);
    const csv = [h, ...r].map(row => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'commission-report.csv';
    a.click();
  };

  if (!currentUser) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
          <div className="text-center mb-8">
            <DollarSign className="w-16 h-16 mx-auto text-blue-600 mb-4" />
            <h1 className="text-3xl font-bold text-gray-800">Commission Tracker</h1>
            <p className="text-gray-600 mt-2">Sales Commission Management</p>
          </div>
          <div className="flex gap-2 mb-6">
            <button onClick={() => setIsAdminLogin(false)} className={`flex-1 py-2 rounded-lg font-medium ${!isAdminLogin ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'}`}>Salesperson</button>
            <button onClick={() => setIsAdminLogin(true)} className={`flex-1 py-2 rounded-lg font-medium ${isAdminLogin ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'}`}>Admin</button>
          </div>
          <div className="space-y-4">
            {isAdminLogin ? (
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Admin Password</label>
                <div className="relative">
                  <input type={showPassword ? "text" : "password"} value={adminPassword} onChange={(e) => setAdminPassword(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter password" />
                  <button onClick={() => setShowPassword(!showPassword)} className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500">
                    {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                  </button>
                </div>
                <p className="text-xs text-gray-500 mt-1">Default: admin123</p>
              </div>
            ) : (
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Salesperson Code</label>
                <input type="text" value={loginCode} onChange={(e) => setLoginCode(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleLogin()} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter your code" />
              </div>
            )}
            <button onClick={handleLogin} className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-medium">Login</button>
          </div>
        </div>
      </div>
    );
  }

  if (currentUser.type === 'salesperson') {
    const myTrans = transactions.filter(t => t.code === currentUser.code);
    const stats = getSalespersonStats(currentUser.code);
    const getProdSummary = () => {
      const pm = {};
      myTrans.forEach(t => {
        if (!pm[t.productName]) pm[t.productName] = { name: t.productName, quantity: 0, sales: 0, commission: 0 };
        pm[t.productName].quantity += t.quantity;
        pm[t.productName].sales += t.amount;
        pm[t.productName].commission += t.commission;
      });
      return Object.values(pm).sort((a, b) => b.sales - a.sales);
    };

    return (
      <div className="min-h-screen bg-gray-50">
        <nav className="bg-white shadow-sm border-b">
          <div className="max-w-7xl mx-auto px-4 py-4">
            <div className="flex justify-between items-center">
              <div className="flex items-center">
                <DollarSign className="w-8 h-8 text-blue-600 mr-2" />
                <div>
                  <h1 className="text-xl font-bold text-gray-800">{currentUser.name}</h1>
                  <p className="text-xs text-gray-600">Code: {currentUser.code}</p>
                </div>
              </div>
              <button onClick={handleLogout} className="px-4 py-2 text-sm text-gray-600 hover:text-gray-800">Logout</button>
            </div>
          </div>
        </nav>
        <div className="max-w-7xl mx-auto px-4 py-8">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div className="bg-white rounded-lg shadow p-6">
              <p className="text-gray-600 text-sm">Commission Rate</p>
              <p className="text-3xl font-bold text-blue-600 mt-2">{currentUser.commission}%</p>
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <p className="text-gray-600 text-sm">Total Sales</p>
              <p className="text-3xl font-bold text-gray-800 mt-2">${stats.totalSales.toFixed(2)}</p>
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <p className="text-gray-600 text-sm">Pending</p>
              <p className="text-3xl font-bold text-orange-600 mt-2">${stats.pendingCommission.toFixed(2)}</p>
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <p className="text-gray-600 text-sm">Paid</p>
              <p className="text-3xl font-bold text-green-600 mt-2">${stats.paidCommission.toFixed(2)}</p>
            </div>
          </div>
          {myTrans.length > 0 && (
            <div className="bg-white rounded-lg shadow p-6 mb-6">
              <h3 className="text-lg font-semibold text-gray-800 mb-4">Products I've Sold</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {getProdSummary().map((p, i) => (
                  <div key={i} className="border border-gray-200 rounded-lg p-4">
                    <h4 className="font-semibold text-gray-800 mb-2">{p.name}</h4>
                    <div className="space-y-1 text-sm">
                      <div className="flex justify-between"><span className="text-gray-600">Qty:</span><span className="font-medium">{p.quantity}</span></div>
                      <div className="flex justify-between"><span className="text-gray-600">Sales:</span><span className="font-medium">${p.sales.toFixed(2)}</span></div>
                      <div className="flex justify-between border-t pt-1 mt-1"><span className="text-gray-600">Commission:</span><span className="font-semibold text-blue-600">${p.commission.toFixed(2)}</span></div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
          <div className="bg-white rounded-lg shadow p-6">
            <h3 className="text-lg font-semibold text-gray-800 mb-4">Transaction History</h3>
            {myTrans.length === 0 ? (
              <p className="text-gray-600 text-center py-8">No transactions yet</p>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-4 py-3 text-left text-sm font-medium text-gray-700">Date</th>
                      <th className="px-4 py-3 text-left text-sm font-medium text-gray-700">Product</th>
                      <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">Qty</th>
                      <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">Sale</th>
                      <th className="px-4 py-3 text-right text-sm font-medium text-gray-700">Commission</th>
                      <th className="px-4 py-3 text-center text-sm font-medium text-gray-700">Status</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y">
                    {myTrans.map(t => (
                      <tr key={t.id}>
                        <td className="px-4 py-3 text-gray-800">{t.date}</td>
                        <td className="px-4 py-3 text-gray-800 font-medium">{t.productName}</td>
                        <td className="px-4 py-3 text-right text-gray-600">{t.quantity}</td>
                        <td className="px-4 py-3 text-right text-gray-800">${t.amount.toFixed(2)}</td>
                        <td className="px-4 py-3 text-right font-semibold text-blue-600">${t.commission.toFixed(2)}</td>
                        <td className="px-4 py-3 text-center">
                          <span className={`px-3 py-1 rounded-full text-xs font-medium ${t.paymentStatus === 'paid' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}`}>
                            {t.paymentStatus === 'paid' ? 'Paid' : 'Pending'}
                          </span>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  const stats = getFilteredStats();

  return (
    <div className="min-h-screen bg-gray-50">
      <nav className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex justify-between items-center">
            <div className="flex items-center">
              <DollarSign className="w-8 h-8 text-blue-600 mr-2" />
              <h1 className="text-xl font-bold text-gray-800">Admin Panel</h1>
            </div>
            <button onClick={handleLogout} className="px-4 py-2 text-sm text-gray-600">Logout</button>
          </div>
        </div>
      </nav>
      <div className="max-w-7xl mx-auto px-4 py-8">
        <div className="flex gap-2 mb-6 border-b overflow-x-auto">
          {['dashboard', 'salespeople', 'transactions', 'payments'].map(tab => (
            <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 font-medium whitespace-nowrap ${activeTab === tab ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}`}>
              {tab === 'dashboard' && <TrendingUp className="inline w-4 h-4 mr-2" />}
              {tab === 'salespeople' && <Users className="inline w-4 h-4 mr-2" />}
              {tab === 'transactions' && <History className="inline w-4 h-4 mr-2" />}
              {tab === 'payments' && <DollarSign className="inline w-4 h-4 mr-2" />}
              {tab.charAt(0).toUpperCase() + tab.slice(1)}
            </button>
          ))}
        </div>

        {activeTab === 'dashboard' && (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex flex-wrap items-center gap-4 mb-4">
                <h3 className="text-lg font-semibold">Filter by Date</h3>
                <select value={dateFilter} onChange={(e) => setDateFilter(e.target.value)} className="px-4 py-2 border rounded-lg">
                  <option value="all">All Time</option>
                  <option value="month">Specific Month</option>
                  <option value="year">Specific Year</option>
                </select>
                {dateFilter === 'month' && <input type="month" value={customMonth} onChange={(e) => setCustomMonth(e.target.value)} className="px-4 py-2 border rounded-lg" />}
                {dateFilter === 'year' && <input type="number" value={customYear} onChange={(e) => setCustomYear(e.target.value)} placeholder="YYYY" min="2020" max="2100" className="px-4 py-2 border rounded-lg w-32" />}
              </div>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Total Sales</p>
                <p className="text-3xl font-bold text-gray-800 mt-2">${stats.totalSales.toFixed(2)}</p>
                {dateFilter !== 'all' && <p className="text-xs text-gray-500 mt-1">{dateFilter === 'month' ? customMonth : customYear}</p>}
              </div>
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Commissions</p>
                <p className="text-3xl font-bold text-gray-800 mt-2">${stats.totalCommissions.toFixed(2)}</p>
                {dateFilter !== 'all' && <p className="text-xs text-gray-500 mt-1">{dateFilter === 'month' ? customMonth : customYear}</p>}
              </div>
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Pending</p>
                <p className="text-3xl font-bold text-orange-600 mt-2">${stats.pendingPayments.toFixed(2)}</p>
                {dateFilter !== 'all' && <p className="text-xs text-gray-500 mt-1">{dateFilter === 'month' ? customMonth : customYear}</p>}
              </div>
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Transactions</p>
                <p className="text-3xl font-bold text-gray-800 mt-2">{stats.transactionCount}</p>
                {dateFilter !== 'all' && <p className="text-xs text-gray-500 mt-1">{dateFilter === 'month' ? customMonth : customYear}</p>}
              </div>
            </div>
            {transactions.length > 0 && (
              <div className="space-y-6">
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div className="bg-white rounded-lg shadow p-6">
                    <h3 className="text-lg font-semibold mb-4">Top Performers</h3>
                    <ResponsiveContainer width="100%" height={300}>
                      <BarChart data={getTopPerformers().slice(0, 5)}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="name" />
                        <YAxis />
                        <Tooltip formatter={(v) => `${v.toFixed(2)}`} />
                        <Bar dataKey="totalCommission" fill="#3b82f6" />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                  <div className="bg-white rounded-lg shadow p-6">
                    <h3 className="text-lg font-semibold mb-4">Monthly Trends</h3>
                    <ResponsiveContainer width="100%" height={300}>
                      <LineChart data={getMonthlyData()}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="month" />
                        <YAxis />
                        <Tooltip formatter={(v) => `${v.toFixed(2)}`} />
                        <Legend />
                        <Line type="monotone" dataKey="sales" stroke="#3b82f6" strokeWidth={2} />
                        <Line type="monotone" dataKey="commissions" stroke="#10b981" strokeWidth={2} />
                      </LineChart>
                    </ResponsiveContainer>
                  </div>
                </div>
                <div className="bg-white rounded-lg shadow p-6">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold">Performance Summary</h3>
                    <button onClick={exportToCSV} className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center text-sm">
                      <Download className="w-4 h-4 mr-2" />Export
                    </button>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-4 py-3 text-left text-sm font-medium">Name</th>
                          <th className="px-4 py-3 text-left text-sm font-medium">Code</th>
                          <th className="px-4 py-3 text-right text-sm font-medium">Sales</th>
                          <th className="px-4 py-3 text-right text-sm font-medium">Count</th>
                          <th className="px-4 py-3 text-right text-sm font-medium">Total</th>
                          <th className="px-4 py-3 text-right text-sm font-medium">Pending</th>
                          <th className="px-4 py-3 text-right text-sm font-medium">Paid</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y">
                        {getTopPerformers().map(sp => (
                          <tr key={sp.id}>
                            <td className="px-4 py-3">{sp.name}</td>
                            <td className="px-4 py-3 font-mono text-sm">{sp.code}</td>
                            <td className="px-4 py-3 text-right">${sp.totalSales.toFixed(2)}</td>
                            <td className="px-4 py-3 text-right">{sp.count}</td>
                            <td className="px-4 py-3 text-right font-semibold">${sp.totalCommission.toFixed(2)}</td>
                            <td className="px-4 py-3 text-right text-orange-600">${sp.pendingCommission.toFixed(2)}</td>
                            <td className="px-4 py-3 text-right text-green-600">${sp.paidCommission.toFixed(2)}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            )}
            {transactions.length === 0 && (
              <div className="bg-white rounded-lg shadow p-12 text-center">
                <History className="w-16 h-16 mx-auto text-gray-400 mb-4" />
                <h3 className="text-xl font-semibold mb-2">No Transactions</h3>
                <p className="text-gray-600">Add salespeople and record transactions</p>
              </div>
            )}
          </div>
        )}

        {activeTab === 'salespeople' && (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4">Add Salesperson</h3>
              <div className="grid grid-cols-1 md:grid-cols-6 gap-4">
                <input type="text" placeholder="Full Name" value={newSalesperson.name} onChange={(e) => setNewSalesperson({...newSalesperson, name: e.target.value})} className="px-4 py-2 border rounded-lg" />
                <div className="flex gap-2">
                  <input type="text" placeholder="CODE" value={newSalesperson.code} onChange={(e) => setNewSalesperson({...newSalesperson, code: e.target.value.toUpperCase()})} className="flex-1 px-4 py-2 border rounded-lg" />
                  <button onClick={generateCode} className="px-3 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Gen</button>
                </div>
                <input type="number" placeholder="%" value={newSalesperson.commission} onChange={(e) => setNewSalesperson({...newSalesperson, commission: e.target.value})} className="px-4 py-2 border rounded-lg" step="0.1" />
                <input type="email" placeholder="Email" value={newSalesperson.email} onChange={(e) => setNewSalesperson({...newSalesperson, email: e.target.value})} className="px-4 py-2 border rounded-lg" />
                <button onClick={addSalesperson} className="md:col-span-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center">
                  <Plus className="w-4 h-4 mr-2" />Add
                </button>
              </div>
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4">Salespeople ({salespeople.length})</h3>
              {salespeople.length === 0 ? (
                <p className="text-gray-600 text-center py-8">No salespeople yet</p>
              ) : (
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-4 py-3 text-left text-sm font-medium">Name</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Code</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Commission</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Email</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Actions</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y">
                      {salespeople.map(sp => (
                        <tr key={sp.id}>
                          {editingSalesperson && editingSalesperson.id === sp.id ? (
                            <>
                              <td className="px-4 py-3"><input type="text" value={editingSalesperson.name} onChange={(e) => setEditingSalesperson({...editingSalesperson, name: e.target.value})} className="px-2 py-1 border rounded w-full" /></td>
                              <td className="px-4 py-3"><input type="text" value={editingSalesperson.code} onChange={(e) => setEditingSalesperson({...editingSalesperson, code: e.target.value.toUpperCase()})} className="px-2 py-1 border rounded w-full" /></td>
                              <td className="px-4 py-3"><input type="number" value={editingSalesperson.commission} onChange={(e) => setEditingSalesperson({...editingSalesperson, commission: e.target.value})} className="px-2 py-1 border rounded w-24" step="0.1" /></td>
                              <td className="px-4 py-3"><input type="email" value={editingSalesperson.email} onChange={(e) => setEditingSalesperson({...editingSalesperson, email: e.target.value})} className="px-2 py-1 border rounded w-full" /></td>
                              <td className="px-4 py-3 text-right">
                                <button onClick={saveEditSalesperson} className="text-green-600 hover:text-green-700 mr-3"><Check className="w-5 h-5 inline" /></button>
                                <button onClick={() => setEditingSalesperson(null)} className="text-gray-600 hover:text-gray-700"><X className="w-5 h-5 inline" /></button>
                              </td>
                            </>
                          ) : (
                            <>
                              <td className="px-4 py-3">{sp.name}</td>
                              <td className="px-4 py-3 font-mono text-sm">{sp.code}</td>
                              <td className="px-4 py-3">{sp.commission}%</td>
                              <td className="px-4 py-3 text-sm text-gray-600">{sp.email || '-'}</td>
                              <td className="px-4 py-3 text-right">
                                <button onClick={() => setEditingSalesperson(sp)} className="text-blue-600 hover:text-blue-700 mr-3"><Edit2 className="w-4 h-4 inline" /></button>
                                <button onClick={() => deleteSalesperson(sp.id)} className="text-red-600 hover:text-red-700"><Trash2 className="w-4 h-4 inline" /></button>
                              </td>
                            </>
                          )}
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'transactions' && (
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4">Add Transaction</h3>
              <div className="grid grid-cols-1 md:grid-cols-7 gap-4">
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Salesperson</label>
                  <select value={newTransaction.code} onChange={(e) => setNewTransaction({...newTransaction, code: e.target.value})} className="w-full px-4 py-2 border rounded-lg">
                    <option value="">Select</option>
                    {salespeople.map(sp => (
                      <option key={sp.id} value={sp.code}>{sp.name} ({sp.code}) - {sp.commission}%</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Product Name</label>
                  <input type="text" placeholder="Product" value={newTransaction.productName} onChange={(e) => setNewTransaction({...newTransaction, productName: e.target.value})} className="w-full px-4 py-2 border rounded-lg" />
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Quantity</label>
                  <input type="number" placeholder="Qty" value={newTransaction.quantity} onChange={(e) => handleQuantityOrPriceChange('quantity', e.target.value)} className="w-full px-4 py-2 border rounded-lg" min="1" />
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Unit Price ($)</label>
                  <input type="number" placeholder="Price" value={newTransaction.unitPrice} onChange={(e) => handleQuantityOrPriceChange('unitPrice', e.target.value)} className="w-full px-4 py-2 border rounded-lg" step="0.01" min="0" />
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Total ($)</label>
                  <input type="number" placeholder="Total" value={newTransaction.amount} onChange={(e) => setNewTransaction({...newTransaction, amount: e.target.value})} className="w-full px-4 py-2 border rounded-lg bg-gray-50" step="0.01" min="0" />
                </div>
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Date</label>
                  <input type="date" value={newTransaction.date} onChange={(e) => setNewTransaction({...newTransaction, date: e.target.value})} className="w-full px-4 py-2 border rounded-lg" />
                </div>
                <div className="flex items-end">
                  <button onClick={addTransaction} className="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center">
                    <Plus className="w-4 h-4 mr-2" />Add
                  </button>
                </div>
              </div>
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4">All Transactions ({transactions.length})</h3>
              {transactions.length === 0 ? (
                <p className="text-gray-600 text-center py-8">No transactions yet</p>
              ) : (
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-4 py-3 text-left text-sm font-medium">Date</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Salesperson</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Product</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Qty</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Sale</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Commission</th>
                        <th className="px-4 py-3 text-center text-sm font-medium">Status</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Actions</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y">
                      {transactions.map(t => (
                        <tr key={t.id}>
                          <td className="px-4 py-3 text-sm">{t.date}</td>
                          <td className="px-4 py-3">
                            <div className="text-sm font-medium">{t.salespersonName}</div>
                            <div className="text-xs text-gray-500 font-mono">{t.code}</div>
                          </td>
                          <td className="px-4 py-3">{t.productName}</td>
                          <td className="px-4 py-3 text-right">{t.quantity}</td>
                          <td className="px-4 py-3 text-right">${t.amount.toFixed(2)}</td>
                          <td className="px-4 py-3 text-right font-semibold">${t.commission.toFixed(2)} <span className="text-xs text-gray-500">({t.commissionRate}%)</span></td>
                          <td className="px-4 py-3 text-center">
                            <button onClick={() => t.paymentStatus === 'pending' ? markAsPaid(t.id) : markAsPending(t.id)} className={`px-3 py-1 rounded-full text-xs font-medium ${t.paymentStatus === 'paid' ? 'bg-green-100 text-green-800 hover:bg-green-200' : 'bg-orange-100 text-orange-800 hover:bg-orange-200'}`}>
                              {t.paymentStatus === 'paid' ? 'Paid' : 'Pending'}
                            </button>
                          </td>
                          <td className="px-4 py-3 text-right">
                            <button onClick={() => deleteTransaction(t.id)} className="text-red-600 hover:text-red-700"><Trash2 className="w-4 h-4 inline" /></button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'payments' && (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Total Paid</p>
                <p className="text-3xl font-bold text-green-600 mt-2">${payments.reduce((s, p) => s + p.amount, 0).toFixed(2)}</p>
              </div>
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Total Pending</p>
                <p className="text-3xl font-bold text-orange-600 mt-2">${transactions.filter(t => t.paymentStatus === 'pending').reduce((s, t) => s + t.commission, 0).toFixed(2)}</p>
              </div>
              <div className="bg-white rounded-lg shadow p-6">
                <p className="text-gray-600 text-sm">Payment Records</p>
                <p className="text-3xl font-bold text-gray-800 mt-2">{payments.length}</p>
              </div>
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4">Pending Payments</h3>
              {transactions.filter(t => t.paymentStatus === 'pending').length === 0 ? (
                <p className="text-gray-600 text-center py-8">No pending payments</p>
              ) : (
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-4 py-3 text-left text-sm font-medium">Salesperson</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Product</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Date</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Commission Due</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Action</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y">
                      {transactions.filter(t => t.paymentStatus === 'pending').map(t => (
                        <tr key={t.id}>
                          <td className="px-4 py-3">
                            <div className="font-medium">{t.salespersonName}</div>
                            <div className="text-xs text-gray-500 font-mono">{t.code}</div>
                          </td>
                          <td className="px-4 py-3">{t.productName}</td>
                          <td className="px-4 py-3 text-sm">{t.date}</td>
                          <td className="px-4 py-3 text-right font-semibold text-orange-600">${t.commission.toFixed(2)}</td>
                          <td className="px-4 py-3 text-right">
                            <button onClick={() => markAsPaid(t.id)} className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm">Mark Paid</button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
            <div className="bg-white rounded-lg shadow p-6">
              <h3 className="text-lg font-semibold mb-4">Payment History</h3>
              {payments.length === 0 ? (
                <p className="text-gray-600 text-center py-8">No payments made yet</p>
              ) : (
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-4 py-3 text-left text-sm font-medium">Payment Date</th>
                        <th className="px-4 py-3 text-left text-sm font-medium">Salesperson</th>
                        <th className="px-4 py-3 text-right text-sm font-medium">Amount</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y">
                      {payments.map(p => (
                        <tr key={p.id}>
                          <td className="px-4 py-3 text-sm">{new Date(p.date).toLocaleDateString()}</td>
                          <td className="px-4 py-3">
                            <div className="font-medium">{p.salespersonName}</div>
                            <div className="text-xs text-gray-500 font-mono">{p.code}</div>
                          </td>
                          <td className="px-4 py-3 text-right font-semibold text-green-600">${p.amount.toFixed(2)}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.render(<CommissionTracker />, document.getElementById('root'));
    </script>
</body>
</html>